# RecSys-Notes
记录推荐系统相关的优化经验、学习笔记、面试题。

[TOC]

## 推荐系统适用场景
信息过载+无明确意图

## 推荐系统从0到1
从0到1就是要解决冷启动问题，冷启动问题可以用产品的办法解决，也可以在推荐系统内解决。

### 冷启动
#### 系统冷启动
#### 新用户冷启动
#### 新内容冷启动

### 搭建推荐系统
一个完整的推荐系统包括：数据采集、数据处理、推荐算法、评估体系。
#### 数据采集
数据采集包括了：用户信息采集(人群属性、兴趣问卷)，用户行为数据采集(埋点日志)，推荐日志，内容打标。

#### 数据处理
数据处理包括：样本生成、特征工程、报表

#### 推荐算法
经典推荐架构：召回、排序、策略。从0到1的过程中需要特别关注冷启动问题：系统冷启动、用户冷启动、内容冷启动。
##### 召回
冷启动阶段没有太多用户行为数据。可以采集用户信息、多利用item标签、捕捉实时信息。热门召回、人群热门召回、用户采集兴趣召回、用户实时兴趣召回。
另外需要做召回去重。
##### 排序
冷启动阶段最好是用单目标简单模型，把整个流程跑通。
##### 策略
黑白名单、调权、频控、打散、保量


#### 评估体系
评估体系包括：在线评估（ABtest、报表）、离线评估。

## 推荐系统优化

### 召回优化

#### 召回的评估
召回率、准确率、hit率、内容覆盖度、基尼指数

#### 召回的迭代路径
多路召回。热门召回、关键词召回、i2i、u2i、模型召回。
模型召回：DSSM、TDM

#### 召回负样本处理

#### 推荐历史去重

### 排序优化

- [Google 的 Rules of ML(共43条)](https://developers.google.com/machine-learning/guides/rules-of-ml)[【汉】](https://www.jiqizhixin.com/articles/2018-05-22-12)

#### 排序的评估
- 线上评估
  - ABtest。留存、时长、ctr、刷帖、点赞、评论、转发等
  - 模型评估指标。在线auc、gauc 
- 离线评估
  - 分类。auc、guac
  - 回归。rmse、mae、mape
- debug工具
  - 推荐线上服务debug
    - 在推荐的整个留存打印debug信息，然后把debug信息放到debug工具中展示。
  - 模型debug 
    - TensorBoard 

#### 排序的迭代路径
由一轮排序，到包含粗排、精排的两轮排序。甚至随着候选池的增加，可以增加更多轮排序。
由单一目标排序，到多目标融合排序。
有简单模型到复杂模型。LR、FM、Wide&Deep、DIN、MMOE、SNR

#### 样本
##### label 
不同业务线的业务目标，用户关键行为都不一样，需要针对性的建模。另外构建一套样本是成本非常大的事情，包括推动前端增改卖点，大数据做好样本关联，数据校验，累计一段时间样本用于训练，整个周期会非常长。所以一般推荐在一开始就把所有能想到的user-item的行为数据都做好埋点。
- 电商
  - GMV。GMV=DAU*CTR*CVR*下单次数*单均价。以上指标一般是uv维度，按照天、周级别统计。无法作为直接排序label
  - item级别行为。曝光、击、加购、下单、成单、评分。电商的行为在时间维度上可能不较长，如成单、评分等动作的延迟甚至可能是几天。
- 娱乐
  - 用户总停留时长。TotalDur=DAU*刷帖数*贴均时长=(DNU+DAU*留存)*刷帖数*贴均时长。
  - item级别行为。
    - 隐式反馈：曝光、点击、时长、完播
    - 显式反馈：点赞、评论、转发
- 社交
  - 总互动。总互动=DAU*匹配率*互动数。
  - item级别行为。曝光、点击、关注、互动 

##### 样本处理
样本关联。如何处理延迟正样本。特征的离线在线不一致问题。

##### 多目标融合
引入多目标的几种方式：
- 样本调权
  - 见：[街首页推荐多目标优化之reweight实践：一把双刃剑？](https://zhuanlan.zhihu.com/p/271858727)
- 线性加权。Score = a*scoreA + b * scoreB + c * ScoreC + … + m * ScoreM
  
- 乘法加权。一般用在电商场景 Score = pow(ctr, a) * pow(price, b)
  
超参数搜索的方式[【知乎-哲哲】](https://zhuanlan.zhihu.com/p/304373868)：<span id="parameter-tuning"></span>
- 人工调参(babysitting)
- 网格搜索(Grid Search)
- 随机搜索(Random Search)
- 贝叶斯优化
  - SMBO(Sequential model-based optimization)
- 进化算法
  - 帕累托 

#### 特征
##### 非结构化特征的处理
NLP和CV的引入
视频、图片的自动打标。场景识别、人脸识别、OCR
文本的关键词提取。

##### 特征工程
- 主体维度
  - 用户
    - 人群属性
    - 行为特征
    - 统计特征
  - item
    - 标签
    - 统计特征
  - context
    - 地理位置
    - 时间
    - 推荐tab
- 时效性维度
- 批量特征
- 实时特征

#### 模型



##### 模型结构
正则：L1、L2、Dropout、BatchNorm、Relu
序列建模：Attention、Transformer、GRU、LSTM
参数共享：gate、routing
优化器：FTRL、Adagrad、Adam

##### 偏置处理
位置偏置

##### 多任务模型
大部分推荐系统最终都会过渡到多目标排序，

##### 调参

[超参数搜索方法](#parameter-tuning)


### 策略优化

#### 打造生态：消费者、生产者、平台三方利益兼顾

##### 流量扶持：新内容、新生产者、新品类

#### 探索与利用
缓解回音壁、保持多样性、提供惊喜和新鲜感

#### 如何缓解头部效应


## 推荐系统的未来

### 对长期收益建模

### 对item组合建模

### 极致的时效性
实时特征、实时模型、端上重排

### 更丰富的交互信息

### 与其他模块的协同
迁移学习。引入其他人口(如搜索)，其他app的用户信息。

### 自动化
减少人工干预



